<div class="container" ng-controller="ingredientAutocompleteController" ng-cloak>

  <p class="title">Add a new recipe</p>

  <!-- Identity -->
  <p class="sub-title">Identity</p>
  <div class="row" ng-cloak>
    <div class="col s12 m4 l3">
      <div class="ratio-container" id="containerPreviewImage">
        <div class="ratio-4_3 background-image" id="previewImage" ng-click="simulateClickFile();" ng-style="{'background-image': 'url(/images/default-preview.png)'}"></div>
      </div>
      <input class="hidden" id="uploadImage" type="file" file-model="photoRecipe"/>
    </div>
    <div class="col s12 hide-on-med-and-up" style="height: 28px;"></div>
    <div class="col s12 m7 l8 offset-m1 offset-l1">
      <div class="row">
        <div data-ng-repeat="(k, v) in categories_mapper track by $index" ng-style="$index == 0 && {'background-color': v.color}" ng-click="changeCategory($event, k)" class="col s4 m4 l2 categories">
          {{ v.name }}
        </div>
      </div>
      <div class="row" style="padding-top: 12px;">
        <div class="input-field col s12">
          <input required ng-model="nameRecipe" ng-change="emptyRecipeName = false;" name="nameRecipe" id="nameRecipe" type="text">
          <label for="nameRecipe">Name</label>
          <div class="has-error-block" ng-show="submitted && emptyRecipeName">The recipe name is required and cannot be empty.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ingredients list -->

  <p class="sub-title">Ingredients list</p>
  <div class="row">
    <div class="col s12 m12 l12">
      <div>
        <angucomplete-alt id="ingredients"
        placeholder="Search ingredients"
        pause="400"
        minlength="1"
        match-class="highlight"
        selected-object="addIngredientToRecipe"
        remote-url="http://nourriture.dennajort.fr/api/ingredient/autocomplete?{{urlIngredientExclude}}name="
        remote-url-data-field=""
        title-field="name"
        description-field="category"
        image-field="photo_url"
        template-url="/my-custom-template.html"
        input-class="form-control form-control-small"/>
      </div>
      <p ng-show="recipeIngredients.length == 0">No ingredient defined for this new recipe</p>
      <ul class="row ul-recipe-add-ingredient">
        <li class="col s6 m3 l2" ng-repeat="ingredient in recipeIngredients">
            <div class="ratio-container">
              <div class="ratio-4_3 background-image" style="background-size: 90%" ng-style="{'background-image': 'url({{ ingredient.photo_url }})'}"></div>
            </div>
            <div class="li-recipe-add-ingredient-content">
              <div>
                {{ ingredient.name }} <i class="mdi-navigation-close recipe-remove-ingredient-btn" ng-click="removeIngredientFromRecipe($index)"></i>
              </div>
              <div>
                <a href="#" buttons="no" editable-text="ingredient.quantity" onbeforesave="checkQuantity($data)">
                  {{ ingredient.quantity || 'empty' }}
                </a>
              </div>
            </div>
        </li>
      </ul>
    </div>
  </div>
  {{ recipeIngredients }}


  {{ idIngredientExclude }}
  {{ urlIngredientExclude }}
  <script type="text/ng-template" id="/my-custom-template.html">

  <div class="angucomplete-holder" ng-class="{'angucomplete-dropdown-visible': showDropdown}">
    <input ng-model="searchStr"
    ng-disabled="disableInput"
    type="text"
    placeholder="{{placeholder}}"
    ng-focus="onFocusHandler()"
    class="{{inputClass}}"
    ng-focus="resetHideResults()"
    ng-blur="hideResults($event)"
    autocapitalize="off"
    autocorrect="off"
    autocomplete="off"
    ng-change="inputChangeHandler(searchStr);"/>
    <div class="angucomplete-dropdown" ng-show="showDropdown">
      <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>
      <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>
      <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{'angucomplete-selected-row': $index == currentIndex}">
        <div ng-if="imageField" class="angucomplete-image-holder">
          <img ng-if="result.image && result.image != ''" ng-src="{{result.image}}" class="angucomplete-image"/>
          <div ng-if="!result.image && result.image != ''" class="angucomplete-image-default"></div>
        </div>
        <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>
        <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>
        <div ng-if="matchClass && result.description && result.description != ''" class="angucomplete-description" ng-bind-html="result.description"></div>
        <div ng-if="!matchClass && result.description && result.description != ''" class="angucomplete-description">{{result.description}}</div>
      </div>
      <div class="angucomplete-row" ng-click="selectResult({title: searchStr, originalObject: { name: searchStr, custom: true }})" ng-mouseenter="hoverRow(results.length)" ng-class="{'angucomplete-selected-row': results.length == currentIndex}">
        <div class="angucomplete-title">Select custom ingredient '{{ searchStr }}'</div>
      </div>
    </div>
  </div>
  </script>
</div>
